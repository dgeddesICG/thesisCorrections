%-------------------------------------------------------------------------------------
%Set up document class and basic formatting
%-------------------------------------------------------------------------------------

\documentclass[12pt]{report}
\usepackage[utf8]{inputenc}
\usepackage[a4paper, 
            vmargin = 18mm, 
            hmargin = 15mm, 
            bindingoffset = 25mm, 
            includehead,
            headheight = 10mm
            ]{geometry}
\usepackage{caption,subcaption}
\usepackage{setspace}
\usepackage{graphicx}
\graphicspath{{figure/}} % change path to make importing figures less annoying
\usepackage{fancyhdr}
\usepackage{placeins}
\usepackage{subfiles}
\usepackage{appendix}
\AtBeginEnvironment{appendices}{\crefalias{section}{appendix}}
%-------------------------------------------------------------------------------------
% Import packages to make physics, units, and fractions look pretty
%-------------------------------------------------------------------------------------

\usepackage{amsmath,amssymb,nicefrac}
\usepackage{siunitx}
\AtBeginDocument{\RenewCommandCopy\qty\SI}

\usepackage{physics}

\DeclareSIUnit{\pixel}{\text{pixel}}
\DeclareSIUnit{\fps}{\text{frames-per-second}}
\DeclareMathOperator{\Erfc}{Erfc}
\DeclareMathOperator{\Erf}{Erf}
\usepackage{centernot,cancel}


\usepackage{layouts}
%-------------------------------------------------------------------------------------
% Make the outline chapter have flexible numbers of subheading
%-------------------------------------------------------------------------------------
\usepackage{enumitem}

\setlistdepth{9}

\setlist[itemize,1]{label=\ding{108}}
\setlist[itemize,2]{label=\ding{110}}
\setlist[itemize,3]{label=\ding{117}}
\setlist[itemize,4]{label=\ding{107}}
\setlist[itemize,5]{label=$-$}
\setlist[itemize,6]{label=$*$}
\setlist[itemize,7]{label=$\ding{\bullet}$}
\setlist[itemize,8]{label=$\bullet$}
\setlist[itemize,9]{label=$\bullet$}

\renewlist{itemize}{itemize}{9}
\usepackage{pifont}
%-------------------------------------------------------------------------------------
%Set up bibliography, glossary etc.
%-------------------------------------------------------------------------------------
\usepackage{IEEEtrantools}
\usepackage[numbers]{natbib}
\bibliographystyle{IEEEtranN}

\usepackage[acronym,toc]{glossaries}
\usepackage{bibunits}
\usepackage{acronym}
\usepackage[capitalise]{cleveref}
\creflabelformat{equation}{#2\textup{#1}#3}
\usepackage{notoccite}
%-------------------------------------------------------------------------------------
% Wee function to draw a box around a region in an image and label it
%-------------------------------------------------------------------------------------

\usepackage{tikz}
\usetikzlibrary{matrix,calc}
%\annotatedFigureBoxCustom{bottom-left}{top-right}{label}{label-position}{box-color}{label-color}{border-color}{text-color}
\newcommand*\annotatedFigureBoxCustom[8]{\draw[#5,thick] (#1) rectangle (#2);\node at (#4) [fill=#6,thick,shape=circle,draw=#7,inner sep=1.5pt,font = \tiny\sffamily,text=#8] {\textbf{#3}};} % fiddle with these the shape of box, corner style, line thickness etc
%\annotatedFigureBox{bottom-left}{top-right}{label}{label-position}
\newcommand*\annotatedFigureBox[4]{\annotatedFigureBoxCustom{#1}{#2}{#3}{#4}{red}{white}{black}{black}}

\newcommand*\annotatedFigureText[4]{\node[draw=none, anchor=south west,text=#2, inner sep=0, text width=#3\linewidth,font=\sffamily] at (#1){#4};}

\newenvironment{annotatedFigure}[1]{
    \centering
    \begin{tikzpicture}
        \node[anchor=south west,inner sep=0] (image) at (0,0) {#1};
        \begin{scope}[x={(image.south east)},y={(image.north west)}]}
    {   \end{scope}
    \end{tikzpicture}}
\newcommand{\gridon}{\draw[help lines,xstep=.1,ystep=.1] (0,0) grid (1,1);
                    \foreach \x in {0,1,...,9} { \node [anchor=north] at (\x/10,0) {0.\x}; }
                    \foreach \y in {0,1,...,9} { \node [anchor=east] at (0,\y/10) {0.\y}; }
}

%-------------------------------------------------------------------------------------
% Wee function to have an abstract at the start of each chapter
%-------------------------------------------------------------------------------------
\usepackage{quoting}
% \newcommand{\chapabstract}[1]{
%     \begin{quote}
%         \singlespacing
        
%         \rule{\linewidth}{1pt}
%         #1
%         \vskip-4mm
%         \rule{\linewidth}{1pt}
% \end{quote}}

\newenvironment{chapabstract}
    {
        \quoting[leftmargin = 10mm,rightmargin = 15mm]
        \noindent\textbf{Summary.~}\itshape\ignorespaces
}
{\endquoting}

%-------------------------------------------------------------------------------------
%Put other packages here
%-------------------------------------------------------------------------------------


\usepackage{lipsum}
\newcommand{\addcite}{\textcolor{blue}{[citation needed]}}
\usepackage{algorithm}
\usepackage{algpseudocode}
\usepackage{tensor}
\usepackage[version=4]{mhchem}
\usepackage{multirow}
\usepackage{bm}

\setlength{\headheight}{42pt}
%-------------------------------------------------------------------------------------
%End preamble
%-------------------------------------------------------------------------------------
\begin{document}
\bstctlcite{IEEEexample:BSTcontrol}
%\bstctlcite{bibliography:BSTcontrol}
\pagestyle{fancy}
\fancyhead{}
\fancyhead[R]{\thepage}
\fancyhead[L]{\leftmark}
\include{chapters/titlepage}

\onehalfspacing
\chapter*{Abstract}
\input{chapters/abstract.tex}

\chapter*{Acknowledgements}
\input{chapters/acknowledgements.tex}


\tableofcontents
\listoffigures
\listoftables

\chapter*{Publications}

\begin{bibunit}
    \renewcommand{\bibsection}{}
    \makeatletter
    \renewcommand\@biblabel[1]{\ding{108}}
    \makeatother
    %\def\bibfont{\small} %might remove this
    \nocite{*}
    \putbib[pubs.bib]
    
\end{bibunit}

\chapter*{Declaration}
\subfile{chapters/declaration.tex}

% \chapter*{Outline}
% \subfile{chapters/outline.tex}

\chapter*{Glossary}\label{chap:glossary}
\subfile{chapters/acronyms.tex}


\chapter{Introduction - (*) Still Writing}\label{chap:intro}
\subfile{chapters/introduction.tex}


\chapter{Construction and Characterisation of an \textit{En-Face} Spectral Fluorescence Lifetime Imaging Ophthalmoscope (+) Done To Be Checked}\label{chap:fliodevice}
\subfile{chapters/sfliodevice.tex}

\chapter{Reconstructing Fluorescence Lifetime Images from a Moving Scene (+) Done To Be Checked}\label{chap:motionreg}
\subfile{chapters/motionreg.tex}
% \chapter{FLIM Analysis Methods}\label{chap:flimanalysis}
%\subfile{chapters/flimanalysis.tex}
\chapter{Appraisal of Techniques for Measuring Retinal FAD Concentrations (+ Done to Be Checked)}\label{chap:appFAD}
\subfile{chapters/appraisalFAD.tex}

\chapter{Development of a Tensor-based SFLIM unmixing technique for measuring retinal FAD concentrations (+) Done to be Checked}\label{chap:tensSFLIM}
\subfile{chapters/tensorSFLIM.tex}


% \chapter{Spectrally Resolved Fluorescence Lifetime Imaging (*) Need to Fix English}\label{chap:sflim}
% \subfile{chapters/sflim.tex}

\chapter{Detection of FAD in \textit{in-vivo} rat retinas (-) Under Construction}\label{chap:ratfad}
\subfile{chapters/ratFAD.tex}

\chapter{Novel Applications of TCSPC / Material Discrimination - (*) Need to add results and conclusions}\label{chap:materialdisc}
\subfile{chapters/tcspc.tex}

\chapter{Summary and Conclusions}\label{chap:conclusion}
\subfile{chapters/conclusion.tex}


\begin{appendices}
\appendix



\chapter{Safety Assessment for SFLIO instrument}\label{app:sfliosafety}
\subfile{chapters/appendices/Asflioassessment.tex}



% \chapter{Tensor Algebra for SFLIM unmixing}\label{app:tensoralgebra}
% \subfile{chapters/appendices/Btensoralgebra.tex}
\end{appendices}


\chapter*{Bibliography}
\nocite{*}
\renewcommand{\bibname}{References}
\bibliography{bibliography.bib}

\end{document}